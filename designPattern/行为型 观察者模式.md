### å®šä¹‰ :books:

**å‘å¸ƒ - è®¢é˜…æ¨¡å¼** ï¼ˆPublish-Subscribe Pattern, pub-subï¼‰åˆå«è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè®©å¤šä¸ªè®¢é˜…è€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªå‘å¸ƒè€…ï¼Œæˆ–è€…å«ä¸»é¢˜å¯¹è±¡ï¼Œè¿™ä¸ªä¸»é¢˜å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å°±ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…è‡ªå·±çš„è®¢é˜…è€…å¯¹è±¡ï¼Œä½¿å¾—å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚



**ä¸»è¦æ¶‰åŠä¸‹é¢å‡ ä¸ªæ¦‚å¿µ**

- **Publisher** å‘å¸ƒè€…ï¼Œå½“æ¶ˆæ¯å‘æ­£æ—¶è´Ÿè´£é€šçŸ¥å¯¹åº”è®¢é˜…è€…ã€‚
- **SubScriber** è®¢é˜…è€…ï¼Œå½“æ¶ˆæ¯å‘ç”Ÿè¢«é€šçŸ¥çš„å¯¹è±¡ã€‚
- **SubscriberMap** æŒæœ‰ä¸åŒ type çš„æ•°ç»„ï¼Œå­˜å‚¨æœ‰æ‰€æœ‰è®¢é˜…è€…çš„æ•°ç»„ã€‚
- **type** æ¶ˆæ¯ç±»å‹ï¼Œè®¢é˜…è€…å¯ä»¥è®¢é˜…ä¸åŒçš„æ¶ˆæ¯ç±»å‹ã€‚
- **subscribe** è¯¥æ–¹æ³•å°†è®¢é˜…è€…æ·»åŠ åˆ° SubscriberMap ä¸­å¯¹åº”çš„æ•°ç»„ä¸­ã€‚
- **unSubscribe** è¯¥æ–¹æ³•ä¸ºåœ¨ SubscriberMap ä¸­åˆ é™¤è®¢é˜…è€…
- **notify** è¯¥æ–¹æ³•éå†é€šçŸ¥ SubscriberMap ä¸­å¯¹åº” type çš„æ¯ä¸ªè®¢é˜…è€…



**ç»“æ„å›¾**

![5d3010f500015d0c08340462](../.vuepress/public/5d3010f500015d0c08340462.png)



### ä½ æ›¾è§è¿‡çš„è§‚å¯Ÿè€…æ¨¡å¼:eye_speech_bubble:

- èŠå¤©å®¤/ç¾¤ :family:

  å¦‚æœæœ‰äººåœ¨èŠå¤©å®¤å‘è¨€ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠå¤©å®¤é‡Œçš„æ‰€æœ‰äººéƒ½ä¼šå—åˆ°å‘è¨€ã€‚å½“æˆ‘ä»¬è¿›å…¥è¿™ä¸ªç¾¤ï¼Œç›¸å½“äº**è®¢é˜…**äº†åœ¨è¿™ä¸ªèŠå¤©å®¤å‘é€çš„æ¶ˆæ¯ï¼Œå½“æœ‰æ–°çš„æ¶ˆæ¯äº§ç”Ÿï¼ŒèŠå¤©å®¤ä¼šè´Ÿè´£å°†æ¶ˆæ¯**å‘å¸ƒ**ç»™æ‰€æœ‰çš„èŠå¤©å®¤çš„è®¢é˜…è€…ã€‚

- é‚®ä»¶è®¢é˜… :mailbox:

- RSS Feeds 

- Js Window ä¸­çš„ addEventListener ![window_addEventlistener](../.vuepress/public/window_addEventlistener.png)

- Vue ä¸­çš„ [EventBus](https://juejin.im/post/5bb355dae51d450ea4020b42)

- Vue çš„åŒé‡ç»‘å®šåŸç†![5d3011160001b21507260454](../.vuepress/public/5d3011160001b21507260454.png)

  ç»„ä»¶æ¸²æŸ“å‡½æ•°ï¼ˆComponent Rander Functionï¼‰è¢«æ‰§è¡Œå‰ï¼Œä¼šå¯¹æ•°æ®å±‚çš„æ•°æ®è¿›è¡Œå“åº”åŒ–ã€‚å“åº”å¤§è‡´ä½¿ç”¨ [Object.defineProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty) æŠŠæ•°æ®è½¬æ¢ä¸º getter/setterï¼Œå¹¶ä¸ºæ¯ä¸ªæ•°æ®æ¡ä»¶ä¸€ä¸ªè®¢é˜…è€…åˆ—è¡¨çš„è¿‡ç¨‹ã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯ `getter` é—­åŒ…ä¸­çš„å±æ€§ï¼Œå°†ä¼šè®°å½•æ‰€æœ‰ä¾èµ–è¿™ä¸ªæ•°æ®çš„ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“åº”å¼åŒ–åçš„æ•°æ®ç›¸å½“äº**å‘å¸ƒè€…**ã€‚

  æ¯ä¸ªç»„ä»¶éƒ½å¯¹åº”ä¸€ä¸ª Watcher **è®¢é˜…è€…**ã€‚å½“æ¯ä¸ªç»„ä»¶çš„æ¸²æŸ“å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œéƒ½ä¼šå°†æœ¬ç»„ä»¶çš„ Watcher æ”¾åˆ°è‡ªå·±æ‰€ä¾èµ–çš„å“åº”å¼æ•°æ®çš„è®¢é˜…è€…åˆ—è¡¨é‡Œï¼Œè¿™å°±ç›¸å½“äºå®Œæˆäº†**è®¢é˜…**ï¼Œä¸€èˆ¬è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºä¾èµ–æ”¶é›†ï¼ˆDependency Collectï¼‰ã€‚



### ç¼–ç¨‹å®ç° ğŸ‘¨â€ğŸ’»



#### Java

```java

public interface Subject {
  void registerObserver(Observer observer);
  void removeObserver(Observer observer);
  void notifyObservers(Message message);
}

public interface Observer {
  void update(Message message);
}

public class ConcreteSubject implements Subject {
  private List<Observer> observers = new ArrayList<Observer>();

  @Override
  public void registerObserver(Observer observer) {
    observers.add(observer);
  }

  @Override
  public void removeObserver(Observer observer) {
    observers.remove(observer);
  }

  @Override
  public void notifyObservers(Message message) {
    for (Observer observer : observers) {
      observer.update(message);
    }
  }

}

public class ConcreteObserverOne implements Observer {
  @Override
  public void update(Message message) {
    //TODO: è·å–æ¶ˆæ¯é€šçŸ¥ï¼Œæ‰§è¡Œè‡ªå·±çš„é€»è¾‘...
    System.out.println("ConcreteObserverOne is notified.");
  }
}

public class ConcreteObserverTwo implements Observer {
  @Override
  public void update(Message message) {
    //TODO: è·å–æ¶ˆæ¯é€šçŸ¥ï¼Œæ‰§è¡Œè‡ªå·±çš„é€»è¾‘...
    System.out.println("ConcreteObserverTwo is notified.");
  }
}

public class Demo {
  public static void main(String[] args) {
    ConcreteSubject subject = new ConcreteSubject();
    subject.registerObserver(new ConcreteObserverOne());
    subject.registerObserver(new ConcreteObserverTwo());
    subject.notifyObservers(new Message());
  }
}
```



JavaScript 

```javascript
class Publisher {
    constructor() {
        this._subsMap = {}
    }
    
    /* æ¶ˆæ¯è®¢é˜… */
    subscribe(type, cb) {
        if (this._subsMap[type]) {
            if (!this._subsMap[type].includes(cb))
                this._subsMap[type].push(cb)
        } else this._subsMap[type] = [cb]
    }
    
    /* æ¶ˆæ¯é€€è®¢ */
    unsubscribe(type, cb) {
        if (!this._subsMap[type] ||
            !this._subsMap[type].includes(cb)) return
        const idx = this._subsMap[type].indexOf(cb)
        this._subsMap[type].splice(idx, 1)
    }
    
    /* æ¶ˆæ¯å‘å¸ƒ */
    notify(type, ...payload) {
        if (!this._subsMap[type]) return
        this._subsMap[type].forEach(cb => cb(...payload))
    }
}

const adadis = new Publisher()

adadis.subscribe('è¿åŠ¨é‹', message => console.log('152xxx' + message))    // è®¢é˜…è¿åŠ¨é‹
adadis.subscribe('è¿åŠ¨é‹', message => console.log('138yyy' + message))
adadis.subscribe('å¸†å¸ƒé‹', message => console.log('139zzz' + message))    // è®¢é˜…å¸†å¸ƒé‹

adadis.notify('è¿åŠ¨é‹', ' è¿åŠ¨é‹åˆ°è´§äº† ~')   // æ‰“ç”µè¯é€šçŸ¥ä¹°å®¶è¿åŠ¨é‹æ¶ˆæ¯
adadis.notify('å¸†å¸ƒé‹', ' å¸†å¸ƒé‹å”®ç½„äº† T.T') // æ‰“ç”µè¯é€šçŸ¥ä¹°å®¶å¸†å¸ƒé‹æ¶ˆæ¯

// è¾“å‡º:  152xxx è¿åŠ¨é‹åˆ°è´§äº† ~
// è¾“å‡º:  138yyy è¿åŠ¨é‹åˆ°è´§äº† ~
// è¾“å‡º:  139zzz å¸†å¸ƒé‹å”®ç½„äº† T.T
```



### æ€»ç»“ :shit:

ä¸ªäººè§‚ç‚¹ï¼Œè§‚å¯Ÿè€…æ¶ˆè´¹è€…æ¨¡å¼æ ¸å¿ƒä¹Ÿæ˜¯ä¸ºäº† **é«˜å†…èšä½è€¦åˆ** è€ŒæœåŠ¡çš„ã€‚å°†è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…è§£è€¦ã€‚ä¸ç”¨çš„åº”ç”¨åœºæ™¯ä¼šæœ‰ä¸åŒçš„å®ç° :shit: